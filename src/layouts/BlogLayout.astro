---
import Layout from '~/layouts/Layout.astro';
import Header from '~/components/widgets/Header.astro';
import Footer from '~/components/widgets/Footer.astro';
import Announcement from '~/components/widgets/Announcement.astro';

import { headerData, footerData } from '~/navigation';

import type { MetaData } from '~/types';

export interface Props {
  metadata?: MetaData;
  title: string;
  description?: string;
  publishDate?: Date;
  updateDate?: Date;
  tags?: string[];
  image?: string;
}

const { metadata, title, description, publishDate, updateDate, tags, image } = Astro.props;

// Format dates for Arabic locale
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('ar-SA', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};

// Create enhanced metadata for SEO
const enhancedMetadata: MetaData = {
  title: `${title} | مدونة خدمات السعودية`,
  description: description || `اقرأ المزيد عن ${title} في مدونة خدمات السعودية`,
  openGraph: {
    type: 'article',
    images: image ? [{ url: image }] : undefined,
    ...metadata?.openGraph,
  },
  ...metadata,
};
---

<Layout metadata={enhancedMetadata}>
  <slot name="announcement">
    <Announcement />
  </slot>
  <slot name="header">
    <Header {...headerData} isSticky showRssFeed showToggleTheme />
  </slot>
  <main class="rtl:text-right">
    <!-- Breadcrumb Navigation -->
    <div class="bg-gray-50 dark:bg-gray-900 py-4">
      <div class="container mx-auto px-4">
        <nav class="text-sm" aria-label="Breadcrumb">
          <ol class="flex items-center space-x-2 rtl:space-x-reverse">
            <li>
              <a href="/" class="text-primary hover:text-primary/80">الرئيسية</a>
            </li>
            <span class="text-gray-400">›</span>
            <li>
              <a href="/blog" class="text-primary hover:text-primary/80">المدونة</a>
            </li>
            <span class="text-gray-400">›</span>
            <li class="text-gray-600 dark:text-gray-400">{title}</li>
          </ol>
        </nav>
      </div>
    </div>

    <!-- Article Content -->
    <article class="container mx-auto px-4 py-8">
      <div class="max-w-4xl mx-auto">
        <!-- Article Header -->
        <header class="mb-8">
          {image && (
            <div class="mb-8">
              <img 
                src={image} 
                alt={title}
                class="w-full h-64 md:h-96 object-cover rounded-lg shadow-lg"
              />
            </div>
          )}
          
          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4 leading-tight">
            {title}
          </h1>
          
          {description && (
            <p class="text-xl text-gray-600 dark:text-gray-300 mb-6 leading-relaxed">
              {description}
            </p>
          )}

          <!-- Article Meta -->
          <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mb-8">
            {publishDate && (
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <span>نشر في {formatDate(publishDate)}</span>
              </div>
            )}
            
            {updateDate && updateDate !== publishDate && (
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <span>آخر تحديث: {formatDate(updateDate)}</span>
              </div>
            )}
          </div>

          <!-- Tags -->
          {tags && tags.length > 0 && (
            <div class="flex flex-wrap gap-2 mb-8">
              {tags.map(tag => (
                <span class="bg-primary/10 text-primary px-3 py-1 rounded-full text-sm font-medium">
                  #{tag}
                </span>
              ))}
            </div>
          )}
        </header>

        <!-- Article Content -->
        <div class="prose prose-lg max-w-none dark:prose-invert rtl:text-right">
          <slot />
        </div>

        <!-- Article Footer -->
        <footer class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
              هل تحتاج لخدماتنا؟
            </h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">
              تواصل معنا للحصول على استشارة مجانية وخدمات عالية الجودة
            </p>
            <div class="flex flex-col sm:flex-row gap-4">
              <a 
                href="tel:+966123456789" 
                class="bg-primary text-white px-6 py-2 rounded-lg font-semibold hover:bg-primary/90 transition-colors text-center"
              >
                اتصل الآن
              </a>
              <a 
                href="/services" 
                class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-6 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-center"
              >
                تصفح الخدمات
              </a>
            </div>
          </div>
        </footer>
      </div>
    </article>
  </main>
  <slot name="footer">
    <Footer {...footerData} />
  </slot>
</Layout>